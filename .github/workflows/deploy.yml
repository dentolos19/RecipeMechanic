name: Deploy Nightly Release
on: [ push, pull_request, workflow_dispatch ]
env:
  release-tag: Nightly
jobs:
  deploy:
    runs-on: windows-latest
    permissions:
      contents: write
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
    - name: Setup .NET
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: 6.0.x
    - name: Publish Project
      run: |
        dotnet publish --runtime win-x64 --self-contained --configuration Release --output build/win-x64
        dotnet publish --runtime win-arm64 --self-contained --configuration Release --output build/win-arm64
    - name: Create Package (x64)
      uses: vimtor/action-zip@v1
      with:
        files: build/win-x64
        dest: ${{ github.event.repository.name }}_win-x64.zip
    - name: Create Package (arm64)
      uses: vimtor/action-zip@v1
      with:
        files: build/win-arm64
        dest: ${{ github.event.repository.name }}_win-arm64.zip
    - name: Delete Existing Tag
      uses: dev-drprasad/delete-tag-and-release@v0.2.0
      with:
        delete_release: true
        tag_name: ${{ env.release-tag }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - name: Deploy Release
      uses: ncipollo/release-action@v1
      with:
        artifacts: ${{ github.event.repository.name }}_win-x64.zip,${{ github.event.repository.name }}_win-arm64.zip
        prerelease: true
        tag: ${{ env.release-tag }}
        commit: main